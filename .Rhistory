group_by(paper_id) %>%
mutate(weight = 1/lengh(unique(i))) %>%
ungroup() %>%
compute()
el_2m <- tbl_mag_paper_authors %>%select(-order) %>% rename(i = author_id) %>%
left_join(tbl_mag_paper_authors %>%select(-order) %>% rename(j = author_id), by = 'paper_id') %>%
filter(i != j) %>%
inner_join(tbl_mag_papers %>% select(id, year), by = c('paper_id' = 'id')) %>%
compute()
tbl_mag_papers
tbl_mag_author_affiliation
tbl_affiliation_paper <- tbl_mag_author_affiliation %>%
select(paper_id, author_id, affiliation_id)%>%
inner_join(tbl_affiliation_type, by = c('affiliation_id' = 'id'))
tbl_author_year <- readRDS('../temp.tbl_author_year.rds')
tbl_author_year
readRDS('../temp.tbl_author_year.rds') %>% copy_to(con, ., name = XTRA_author_year)
copy_to()
?copy_to
readRDS('../temp.tbl_author_year.rds') %>% copy_to(con, ., name = 'XTRA_author_year')
db_list_tables(con) %>% sort()
XTRA_author_year
tbl_author_year <- tbl(con, "XTRA_author_year")
tbl_author_year
tbl_mag_author_affiliation
tbl_mag_author_affiliation
tbl_affiliation_type <- tbl(con, "affiliation_type")
tbl_affiliation_type %>% head()
tbl_author_affiliation_type <- tbl_mag_author_affiliation %>%
select(-id) %>%
inner_join(tbl_affiliation_type, by = 'paper_id') %>%
compute()
tbl_mag_author_affiliation
tbl_affiliation_type
tbl_author_affiliation_type <- tbl_mag_author_affiliation %>%
select(-id) %>%
inner_join(tbl_affiliation_type, by = c('paper_id'='id')) %>%
compute()
tbl_author_affiliation_type
tbl_author_affiliation_type
tbl_author_affiliation_type <- tbl_mag_author_affiliation %>%
select(-id) %>%
inner_join(tbl_affiliation_type, by = c('paper_id'='id')) %>%
compute()
tbl_author_affiliation_type
tbl_author_affiliation_type  %>% head()
tbl_author_affiliation_type
tbl_affiliation_type
tbl_mag_author_affiliation
el_2m
el_2m
############################################################################
# Preamble
############################################################################
rm(list=ls())
### Load packages
library(tidyverse)
library(magrittr)
library(DBI) # GEneral R database interface
library(RPostgres) # PostgreSQL interface driver
library(dbplyr) # for dplyr with databases
### Database connection
# set up connection to existing PostgreSQL database, just plug in own details
con <- dbConnect(drv = RPostgres::Postgres(),
dbname = "patentdb",
host = "130.225.57.105", port = 5432,
user = "patentdbowner", password = "e6rKPT2iZ99@PKaa")
db_list_tables(con) %>% sort()
### set up tables
# Papers
tbl_mag_papers <- tbl(con, "mag_papers")
tbl_mag_papers %>% glimpse()
# Authors
tbl_mag_paper_authors <- tbl(con, "mag_paper_authors")
tbl_mag_paper_authors %>% head()
# Affiliation
tbl_mag_author_affiliation <- tbl(con, "mag_author_affiliation")
tbl_mag_author_affiliation %>% head()
tbl_affiliation_type <- tbl(con, "affiliation_type")
tbl_affiliation_type %>% head()
############################################################################
# Network Analysis
############################################################################
# Load packages
library(tidygraph)
library(igraph)
el_2m <- tbl_mag_paper_authors %>%select(-order) %>% rename(i = author_id) %>%
left_join(tbl_mag_paper_authors %>%select(-order) %>% rename(j = author_id), by = 'paper_id') %>%
filter(i != j) %>%
inner_join(tbl_mag_papers %>% select(id, year, citations, publication_type), by = c('paper_id' = 'id')) %>%
mutate(year = year %>% as.numeric(),
citations = citations %>% as.numeric()) %>%
compute()
el_2m
el_2m <- tbl_mag_paper_authors %>%select(-order) %>% rename(i = author_id) %>%
left_join(tbl_mag_paper_authors %>%select(-order) %>% rename(j = author_id), by = 'paper_id') %>%
filter(i != j) %>%
inner_join(tbl_mag_papers %>% select(id, year), by = c('paper_id' = 'id')) %>%
mutate(year = year %>% as.numeric(),
citations = citations %>% as.numeric()) %>%
compute()
el_2m <- tbl_mag_paper_authors %>%select(-order) %>% rename(i = author_id) %>%
left_join(tbl_mag_paper_authors %>%select(-order) %>% rename(j = author_id), by = 'paper_id') %>%
filter(i != j) %>%
inner_join(tbl_mag_papers %>% select(id, year), by = c('paper_id' = 'id')) %>%
mutate(year = year %>% as.numeric()) %>%
compute()
el_2m
tbl_author_year <-
readRDS('../temp.tbl_author_year.rds') %>% copy_to(con, name = 'XTRA_author_type')
readRDS('../temp.tbl_author_year.rds') %>% copy_to(con, name = 'XTRA_author_type')
?copy_to
readRDS('../temp/tbl_author_year.rds') %>% copy_to(con, name = 'XTRA_author_type')
tbl_author_type <- readRDS('../temp/tbl_author_type.rds')
############################################################################
# Preamble
############################################################################
rm(list=ls())
### Load packages
library(tidyverse)
library(magrittr)
library(DBI) # GEneral R database interface
library(RPostgres) # PostgreSQL interface driver
library(dbplyr) # for dplyr with databases
### Database connection
# set up connection to existing PostgreSQL database, just plug in own details
con <- dbConnect(drv = RPostgres::Postgres(),
dbname = "patentdb",
host = "130.225.57.105", port = 5432,
user = "patentdbowner", password = "e6rKPT2iZ99@PKaa")
# Inspect DB:
db_list_tables(con) %>% sort()
### set up tables
# Papers
tbl_mag_papers <- tbl(con, "mag_papers")
tbl_mag_papers %>% glimpse()
# Authors
tbl_mag_paper_authors <- tbl(con, "mag_paper_authors")
tbl_mag_paper_authors %>% head()
tbl_author_gender <- tbl(con, "author_gender")
tbl_author_gender %>% head()
# Affiliation
tbl_mag_author_affiliation <- tbl(con, "mag_author_affiliation")
tbl_mag_author_affiliation %>% head()
tbl_affiliation_type <- tbl(con, "affiliation_type")
tbl_affiliation_type %>% head()
tbl_mag_affiliation <- tbl(con, "mag_affiliation")
tbl_mag_affiliation %>% head()
tbl_geocoded_places <- tbl(con, "geocoded_places")
tbl_geocoded_places %>% glimpse()
# Field of study
tbl_mag_fields_of_study <- tbl(con, "mag_fields_of_study")
tbl_mag_fields_of_study %>% glimpse()
tbl_mag_paper_fields_of_study <- tbl(con, "mag_paper_fields_of_study")
tbl_mag_paper_fields_of_study %>% glimpse()
tbl_mag_field_of_study_metadata <- tbl(con, "mag_field_of_study_metadata")
tbl_mag_field_of_study_metadata %>% glimpse()
############################################################################
# Merging
############################################################################
tbl_author_paper <- tbl_mag_papers %>%
select(id, year, citations) %>%
rename(paper_id = id) %>%
mutate(year = year %>% as.numeric(),
citations = as.numeric(citations) / (2021 - year) ) %>%
inner_join(tbl_mag_author_affiliation %>% select(paper_id, author_id, affiliation_id), by = 'paper_id') %>%
inner_join(tbl_affiliation_type, by = c('affiliation_id' = 'id')) %>%
compute()
###
# TODO: Some preselection??????
###
############################################################################
# Year aggregation author
############################################################################
# Generate
tbl_author_year <- tbl_author_paper %>%
group_by(year, author_id) %>%
summarize(paper_n = n() %>% as.integer(),
cit_mean = citations %>% mean(na.rm = TRUE) %>% round(2),
affiliation = type %>% mean(na.rm = TRUE) %>% round(0)) %>%
select(author_id, year, paper_n, cit_mean, affiliation) %>%
collect() %>%
drop_na(author_id, year, cit_mean, affiliation)
# Fill missing year
tbl_author_year %<>%
arrange(author_id, year) %>%
relocate(author_id, year) %>%
group_by(author_id) %>%
complete(year = full_seq(min(year):max(year), 1)) %>%
fill(affiliation) %>%
ungroup() %>%
replace_na(list(paper_n = 0, cit_mean = 0))
###
# TODO Find multipe switchers
###
### Identify types
tbl_author_type <- tbl_author_year %>%
group_by(author_id) %>%
summarize(affil_mean = affiliation %>% mean(na.rm = TRUE),
paper_mean = paper_n %>% mean(na.rm = TRUE),
cit_mean = cit_mean %>% mean(na.rm = TRUE),
year_start = min(year),
year_end = max(year),
) %>%
mutate(author_type = case_when(affil_mean == 0 ~ 'industry',
affil_mean > 0 & affil_mean < 1 ~ 'switcher',
affil_mean == 1 ~ 'academia',
TRUE ~ 'others'),
year_n = year_end - year_start + 1) %>%
select(author_id, author_type, paper_mean, cit_mean, year_start, year_end, year_n)
# in between save
tbl_author_type %>% saveRDS('../temp.tbl_author_type.rds')
### Identify switches.....
# Join the type back
tbl_author_year %<>%
left_join(tbl_author_type %>% select(author_id, author_type), by = 'author_id')
# Find switching point
tbl_author_year %<>%
group_by(author_id) %>%
mutate(transited = ifelse(affiliation != lead(affiliation, 1) &
affiliation != lead(affiliation, 1), TRUE, NA)) %>%
fill(transited, .direction = 'down') %>%
replace_na(list(transited = FALSE)) %>%
mutate(switch = ifelse(transited == TRUE & lag(transited, 1) == FALSE, TRUE, FALSE))  %>%
replace_na(list(switch = FALSE)) %>%
ungroup()
# in between save
tbl_author_year %>% saveRDS('../temp.tbl_author_year.rds')
############################################################################
# Preamble
############################################################################
rm(list=ls())
### Load packages
library(tidyverse)
library(magrittr)
library(DBI) # GEneral R database interface
library(RPostgres) # PostgreSQL interface driver
library(dbplyr) # for dplyr with databases
### Database connection
# set up connection to existing PostgreSQL database, just plug in own details
con <- dbConnect(drv = RPostgres::Postgres(),
dbname = "patentdb",
host = "130.225.57.105", port = 5432,
user = "patentdbowner", password = "e6rKPT2iZ99@PKaa")
db_list_tables(con) %>% sort()
### set up tables
# Papers
tbl_mag_papers <- tbl(con, "mag_papers")
tbl_mag_papers %>% glimpse()
# Authors
tbl_mag_paper_authors <- tbl(con, "mag_paper_authors")
tbl_mag_paper_authors %>% head()
# Affiliation
tbl_mag_author_affiliation <- tbl(con, "mag_author_affiliation")
tbl_mag_author_affiliation %>% head()
tbl_affiliation_type <- tbl(con, "affiliation_type")
tbl_affiliation_type %>% head()
############################################################################
# Network Analysis
############################################################################
# Load packages
library(tidygraph)
library(igraph)
el_2m <- tbl_mag_paper_authors %>%select(-order) %>% rename(i = author_id) %>%
left_join(tbl_mag_paper_authors %>%select(-order) %>% rename(j = author_id), by = 'paper_id') %>%
filter(i != j) %>%
inner_join(tbl_mag_papers %>% select(id, year), by = c('paper_id' = 'id')) %>%
mutate(year = year %>% as.numeric()) %>%
compute()
readRDS('../temp/tbl_author_year.rds') %>% copy_to(con, name = 'XTRA_author_type')
tbl_author_year <- tbl(con, "XTRA_author_type")
############################################################################
# Preamble
############################################################################
rm(list=ls())
### Load packages
library(tidyverse)
library(magrittr)
library(DBI) # GEneral R database interface
library(RPostgres) # PostgreSQL interface driver
library(dbplyr) # for dplyr with databases
### Database connection
# set up connection to existing PostgreSQL database, just plug in own details
con <- dbConnect(drv = RPostgres::Postgres(),
dbname = "patentdb",
host = "130.225.57.105", port = 5432,
user = "patentdbowner", password = "e6rKPT2iZ99@PKaa")
db_list_tables(con) %>% sort()
### set up tables
# Papers
tbl_mag_papers <- tbl(con, "mag_papers")
tbl_mag_papers %>% glimpse()
# Authors
tbl_mag_paper_authors <- tbl(con, "mag_paper_authors")
tbl_mag_paper_authors %>% head()
# Affiliation
tbl_mag_author_affiliation <- tbl(con, "mag_author_affiliation")
tbl_mag_author_affiliation %>% head()
tbl_affiliation_type <- tbl(con, "affiliation_type")
tbl_affiliation_type %>% head()
############################################################################
# Network Analysis
############################################################################
# Load packages
library(tidygraph)
library(igraph)
el_2m <- tbl_mag_paper_authors %>%select(-order) %>% rename(i = author_id) %>%
left_join(tbl_mag_paper_authors %>%select(-order) %>% rename(j = author_id), by = 'paper_id') %>%
filter(i != j) %>%
inner_join(tbl_mag_papers %>% select(id, year), by = c('paper_id' = 'id')) %>%
mutate(year = year %>% as.numeric()) %>%
compute()
readRDS('../temp/tbl_author_year.rds') %>% copy_to(con, name = 'XTRA_author_type')
tbl_author_year <- tbl(con, "XTRA_author_type")
############################################################################
# Preamble
############################################################################
rm(list=ls())
### Load packages
library(tidyverse)
library(magrittr)
library(DBI) # GEneral R database interface
library(RPostgres) # PostgreSQL interface driver
library(dbplyr) # for dplyr with databases
### Database connection
# set up connection to existing PostgreSQL database, just plug in own details
con <- dbConnect(drv = RPostgres::Postgres(),
dbname = "patentdb",
host = "130.225.57.105", port = 5432,
user = "patentdbowner", password = "e6rKPT2iZ99@PKaa")
db_list_tables(con) %>% sort()
### set up tables
# Papers
tbl_mag_papers <- tbl(con, "mag_papers")
tbl_mag_papers %>% glimpse()
# Authors
tbl_mag_paper_authors <- tbl(con, "mag_paper_authors")
tbl_mag_paper_authors %>% head()
# Affiliation
tbl_mag_author_affiliation <- tbl(con, "mag_author_affiliation")
tbl_mag_author_affiliation %>% head()
tbl_affiliation_type <- tbl(con, "affiliation_type")
tbl_affiliation_type %>% head()
############################################################################
# Network Analysis
############################################################################
# Load packages
library(tidygraph)
library(igraph)
el_2m <- tbl_mag_paper_authors %>%select(-order) %>% rename(i = author_id) %>%
left_join(tbl_mag_paper_authors %>%select(-order) %>% rename(j = author_id), by = 'paper_id') %>%
filter(i != j) %>%
inner_join(tbl_mag_papers %>% select(id, year), by = c('paper_id' = 'id')) %>%
mutate(year = year %>% as.numeric()) %>%
compute()
readRDS('../temp/tbl_author_year.rds') %>% copy_to(con, name = 'XTRA_author_type')
tbl_author_year <- tbl(con, "XTRA_author_type")
############################################################################
# Preamble
############################################################################
rm(list=ls())
### Load packages
library(tidyverse)
library(magrittr)
library(DBI) # GEneral R database interface
library(RPostgres) # PostgreSQL interface driver
library(dbplyr) # for dplyr with databases
### Database connection
# set up connection to existing PostgreSQL database, just plug in own details
con <- dbConnect(drv = RPostgres::Postgres(),
dbname = "patentdb",
host = "130.225.57.105", port = 5432,
user = "patentdbowner", password = "e6rKPT2iZ99@PKaa")
db_list_tables(con) %>% sort()
### set up tables
# Papers
tbl_mag_papers <- tbl(con, "mag_papers")
tbl_mag_papers %>% glimpse()
# Authors
tbl_mag_paper_authors <- tbl(con, "mag_paper_authors")
tbl_mag_paper_authors %>% head()
# Affiliation
tbl_mag_author_affiliation <- tbl(con, "mag_author_affiliation")
tbl_mag_author_affiliation %>% head()
tbl_affiliation_type <- tbl(con, "affiliation_type")
tbl_affiliation_type %>% head()
############################################################################
# Network Analysis
############################################################################
# Load packages
library(tidygraph)
library(igraph)
el_2m <- tbl_mag_paper_authors %>%select(-order) %>% rename(i = author_id) %>%
left_join(tbl_mag_paper_authors %>%select(-order) %>% rename(j = author_id), by = 'paper_id') %>%
filter(i != j) %>%
inner_join(tbl_mag_papers %>% select(id, year), by = c('paper_id' = 'id')) %>%
mutate(year = year %>% as.numeric()) %>%
compute()
readRDS('../temp/tbl_author_year.rds') %>% copy_to(con, name = 'XTRA_author_type')
readRDS('../temp/tbl_author_year.rds') %>% copy_to(con, data = ., name = 'XTRA_author_type')
readRDS('../temp/tbl_author_year.rds') %>% copy_to(con, df = ., name = 'XTRA_author_type')
tbl_author_year <- tbl(con, "XTRA_author_type")
el_2m
tbl_author_year
tbl_author_year
# Load packages
library(survival)
library(survminer)
library(ggfortify)
# Control:
# TODO: Deep learning dummy -> more likely
# TODO: EV centralityy
# TODO: Previous collaboration industry / Average dist industry......
# Load prepared data
tbl_author_type <- readRDS('../temp/tbl_author_type.rds')
tbl_author_year <- readRDS('../temp/tbl_author_year.rds')
### Filter only for author types interesting here
tbl_author_type %<>%
filter(author_type %in% c('academia', 'switcher') &
year_n >= 5 &
year_end >= 2015)
### Create main data with restrictions on type
data <- tbl_author_year %>%
semi_join(tbl_author_type, by = 'author_id')
### Create some variables
data %<>%
group_by(author_id) %>%
mutate(seniority = year - min(year, na.rm = TRUE) + 1,
cit_n = cit_mean * paper_n,
cit_n_cum = cit_n %>% cumsum()) %>%
ungroup()
# # Only 2000 up to transit
# data %<>%
#   arrange(author_id, year) %>%
#   group_by(author_id) %>%
#   filter(lag(transited) != TRUE) %>%
#   ungroup() %>%
#   select(-switch)
library(MatchIt)
match_psm <- tbl_author_type %>%
mutate(author_type = (author_type %>% factor() %>% as.numeric()) -1 )
match_psm  %<>% matchit(author_type ~ paper_mean + cit_mean + year_n,
data = ., method = "nearest", ratio = 1)
summary(match_psm)
match_psm_out <- match_psm %>%
match.data() %>%
as_tibble() %>%
select(author_id, distance, weights)
### Prepare for regression
data_surv <- data %>%
semi_join(match_psm_out, by = 'author_id') %>%
group_by(author_id) %>%
mutate(cit_n = cit_n %>% lag(1),
cit_n_cum = cit_n_cum %>% lag(1)) %>%
ungroup() %>%
filter(year >= 2000) %>%
group_by(author_id) %>%
mutate(time = 1:n()) %>%
ungroup() %>%
mutate(year = year %>% factor) %>%
drop_na()
# Surf object
surv_object <- Surv(time = data_surv$time, event = data_surv$transited)
fit_km1 <- survfit(surv_object ~ cit_mean,
data = data_surv)
fit_km1 %>% summary()
fit_km1 %>% autoplot()
fit_km1 %>% summary()
### Fir Cox proportional hazard model
fit1_cox <- coxph(surv_object ~ seniority + cit_mean + paper_n + cit_n_cum ,
data = data_surv)
fit1_cox %>% summary()
fit1_cox %>% ggforest(data = data_surv)
tbl_author_year
tbl_author_year
el_2m
el_2m %<>%
inner_join(tbl_author_year %>% select(author_id, year, affiliation) %>% rename(affiliation_i = affiliation), by = c('i' = 'author_id', 'year')) %>%
inner_join(tbl_author_year %>% select(author_id, year, affiliation) %>% rename(affiliation_j = affiliation), by = c('j' = 'author_id', 'year'))
tbl_author_year <- tbl(con, "XTRA_author_type")
el_2m %<>%
inner_join(tbl_author_year %>% select(author_id, year, affiliation) %>% rename(affiliation_i = affiliation), by = c('i' = 'author_id', 'year')) %>%
inner_join(tbl_author_year %>% select(author_id, year, affiliation) %>% rename(affiliation_j = affiliation), by = c('j' = 'author_id', 'year'))
el_2m %<>%
inner_join(tbl_author_year %>% select(author_id, year, affiliation) %>% rename(affiliation_i = affiliation), by = c('i' = 'author_id', 'year')) %>%
inner_join(tbl_author_year %>% select(author_id, year, affiliation) %>% rename(affiliation_j = affiliation), by = c('j' = 'author_id', 'year')) %>%
compute()
el_2m
tbl_author_year %>% select(author_id, year, affiliation) %>% rename(affiliation_i = affiliation)
el_2m <- tbl_mag_paper_authors %>%select(-order) %>% rename(i = author_id) %>%
left_join(tbl_mag_paper_authors %>%select(-order) %>% rename(j = author_id), by = 'paper_id') %>%
filter(i != j) %>%
inner_join(tbl_mag_papers %>% select(id, year), by = c('paper_id' = 'id')) %>%
mutate(year = year %>% as.numeric()) %>%
compute()
el_2m %<>%
inner_join(tbl_author_year %>% select(author_id, year, affiliation) %>% rename(affiliation_i = affiliation), by = c('i' = 'author_id', 'year')) %>%
inner_join(tbl_author_year %>% select(author_id, year, affiliation) %>% rename(affiliation_j = affiliation), by = c('j' = 'author_id', 'year')) %>%
compute()
el_2m
author_cent <- el_2m %>%
collect() %>%
group_by(paper_id) %>%
mutate(weight = 1 / n_distinct(i)) %>%
ungroup() %>%
group_by(i, year) %>%
summarise(cent_dgr = sum(weight),
cent_dgr_uni = sum(weight * affiliation_j)) %>%
mutate(cent_dgr_ind = cent_dgr - cent_dgr_uni)
author_cent
# in between save
author_cent %>% saveRDS('../temp/author_cent.rds')
